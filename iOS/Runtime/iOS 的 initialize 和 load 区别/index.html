<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta name="referrer" content="never">
    <meta charset="utf-8">
    
    <title>知识库</title>
    
    
        <meta name="keywords" content="知识库">
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="[TOC]     load initialize     执行次数 1次 每个类会被系统只调用一次，但是由于继承的关系，子类未实现的情况下父类的方法会被多次调用   执行时机 所有运行时需要用到的类在main函数开始执行之前，与这个类是否被用到无关 懒加载，需要使用到具体类的时候才调用 （类或它的子类收到第一条消息之前被调用的，包括实例方法和类方法，如果没收到消息则永远不会调用）   作用 Ru">
<meta property="og:type" content="article">
<meta property="og:title" content="知识库">
<meta property="og:url" content="http://yoursite.com/iOS/Runtime/iOS 的 initialize 和 load 区别/index.html">
<meta property="og:site_name" content="知识库">
<meta property="og:description" content="[TOC]     load initialize     执行次数 1次 每个类会被系统只调用一次，但是由于继承的关系，子类未实现的情况下父类的方法会被多次调用   执行时机 所有运行时需要用到的类在main函数开始执行之前，与这个类是否被用到无关 懒加载，需要使用到具体类的时候才调用 （类或它的子类收到第一条消息之前被调用的，包括实例方法和类方法，如果没收到消息则永远不会调用）   作用 Ru">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2020-05-11T14:38:19.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="知识库">
<meta name="twitter:description" content="[TOC]     load initialize     执行次数 1次 每个类会被系统只调用一次，但是由于继承的关系，子类未实现的情况下父类的方法会被多次调用   执行时机 所有运行时需要用到的类在main函数开始执行之前，与这个类是否被用到无关 懒加载，需要使用到具体类的时候才调用 （类或它的子类收到第一条消息之前被调用的，包括实例方法和类方法，如果没收到消息则永远不会调用）   作用 Ru">
    

    

    
        <link rel="icon" href="/wiki/favicon.ico">
    

    <link rel="stylesheet" href="/wiki/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/wiki/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/wiki/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/wiki/css/style.css">
    <script src="/wiki/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="/wiki/libs/jquery/plugins/cookie/1.4.1/jquery.cookie.js"></script>
    
    
        <link rel="stylesheet" href="/wiki/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/wiki/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


    
</head>
</html>
<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/wiki/" id="logo">
                
                <span class="site-title">知识库</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/wiki/">首页</a>
                
            </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/wiki/',
        CONTENT_URL: '/wiki/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/wiki/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/wiki/">首页</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
            
                <aside id="sidebar">
   
        
    <div class="widget-wrap" id='categories'>
        <h3 class="widget-title">
            <span>categories</span>
            &nbsp;
            <a id='allExpand' href="#">
                <i class="fa fa-angle-double-down fa-2x"></i>
            </a>
        </h3>
        
        
        
         <ul class="unstyled" id="tree" > 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            C++
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/C++/C++多态/">
                                
                                    
                                    C++多态
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/C++/C++ 与 Objetive-C 的区别/">
                                
                                    
                                    C++ 与 Objetive-C 的区别
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/C++/C++头文件如何正确定义全局变量/">
                                
                                    
                                    C++头文件如何正确定义全局变量
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/C++/dynamic_cast/">
                                
                                    dynamic_cast
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/C++/C++默认参数/">
                                
                                    
                                    C++默认参数
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/C++/C++头文件的全局变量/">
                                
                                    
                                    C++头文件的全局变量
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/C++/unordered_map 与 map 的区别/">
                                
                                    
                                    unordered_map 与 map 的区别
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/C++/C++拾遗/">
                                
                                    
                                    C++拾遗
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/C++/static变量与static函数/">
                                
                                    
                                    static变量与static函数
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            iOS
                        </a>
                         <ul class="unstyled" id="tree" > 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Block
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/iOS/Block/Block 的实现（简化版）/">
                                
                                    
                                    Block 的实现（简化版）
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/Block/Block_面试题/">
                                
                                    
                                    Block_面试题
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/Block/Block/">
                                
                                    
                                    Block
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            GCD
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/iOS/GCD/GCD/">
                                
                                    
                                    GCD
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/GCD/GCD_实践/">
                                
                                    
                                    GCD_实践
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/GCD/dispatch_set_target_queue/">
                                
                                    
                                    dispatch_set_target_queue
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            RunLoop
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/iOS/RunLoop/RunLoop 源码分析/">
                                
                                    
                                    RunLoop 源码分析
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/RunLoop/RunLoop/">
                                
                                    
                                    RunLoop
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory open">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder-open"></i>
                            &nbsp;
                            Runtime
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/iOS/Runtime/Runtime/">
                                
                                    
                                    Runtime
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/Runtime/Runtime_实践/">
                                
                                    
                                    Runtime_实践
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/Runtime/weak 的实现原理/">
                                
                                    
                                    weak 的实现原理
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/Runtime/关联对象的实现原理/">
                                
                                    
                                    关联对象的实现原理
                                
                            </a>
                        </li>  
                        <li class="file active">
                            <a href="/wiki/iOS/Runtime/iOS 的 initialize 和 load 区别/">
                                
                                    
                                    iOS 的 initialize 和 load 区别
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/Runtime/分类/">
                                
                                    
                                    分类
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/Runtime/如何为协议添加属性/">
                                
                                    
                                    如何为协议添加属性
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/Runtime/如何为分类添加属性/">
                                
                                    
                                    如何为分类添加属性
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/Runtime/方法交换/">
                                
                                    
                                    方法交换
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            内存管理
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/iOS/内存管理/Weak-Strong Dance/">
                                
                                    
                                    Weak-Strong Dance
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/内存管理/autorelease/">
                                
                                    
                                    autorelease
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/内存管理/dealloc 探究/">
                                
                                    
                                    dealloc 探究
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            未分类
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/iOS/未分类/NSString 的坑/">
                                
                                    
                                    NSString 的坑
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/未分类/KVC/">
                                
                                    
                                    KVC
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/未分类/UIView 与 CALayer 区别/">
                                
                                    
                                    UIView 与 CALayer 区别
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/未分类/KVO/">
                                
                                    
                                    KVO
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/未分类/Native 与 JS 交互/">
                                
                                    
                                    Native 与 JS 交互
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/未分类/block 和 delegate 的区别/">
                                
                                    
                                    block 和 delegate 的区别
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/未分类/Property/">
                                
                                    
                                    Property
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/未分类/iOS 触摸机制/">
                                
                                    
                                    iOS 触摸机制
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/未分类/离屏渲染/">
                                
                                    
                                    离屏渲染
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/未分类/启动/">
                                
                                    
                                    启动
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/iOS/未分类/杂/">
                                
                                    
                                    杂
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            不务正业
                        </a>
                         <ul class="unstyled" id="tree" > 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            BackEnd
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/不务正业/BackEnd/Ubuntu/">
                                
                                    
                                    Ubuntu
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Python
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/不务正业/Python/Python小知识/">
                                
                                    
                                    Python小知识
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/不务正业/Python/Python参数/">
                                
                                    
                                    Python参数
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/不务正业/Python/文件操作/">
                                
                                    
                                    文件操作
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            VideoNative
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/不务正业/VideoNative/VideoNative_加载VN页面_iOS篇/">
                                
                                    
                                    VideoNative_加载VN页面_iOS篇
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/不务正业/VideoNative/CSS 解析原理/">
                                
                                    CSS 解析原理
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            Xcode
                        </a>
                         <ul class="unstyled" id="tree" > 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            库
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/不务正业/Xcode/库/库体积优化/">
                                
                                    库体积优化
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/不务正业/Xcode/库/动态库和静态库/">
                                
                                    动态库和静态库
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                     
                        <li class="file">
                            <a href="/wiki/不务正业/Xcode/Cocoapods/">
                                
                                    Cocoapods
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/不务正业/Xcode/新建工程移除StroyBoard/">
                                
                                    新建工程移除StroyBoard
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/不务正业/Xcode/使用脚本添加Xcode文件/">
                                
                                    
                                    使用脚本添加Xcode文件
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            iOS 未分类
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/不务正业/iOS 未分类/iOS 图片加载的坑/">
                                
                                    
                                    iOS 图片加载的坑
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/不务正业/iOS 未分类/iOS 沙盒目录结构/">
                                
                                    
                                    iOS 沙盒目录结构
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/不务正业/iOS 未分类/弱引用集合对象/">
                                
                                    
                                    弱引用集合对象
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/不务正业/iOS 未分类/iOS 状态栏/">
                                
                                    
                                    iOS 状态栏
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            前端
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/不务正业/前端/JavaScript/">
                                
                                    
                                    JavaScript
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/不务正业/前端/JS 模块化/">
                                
                                    
                                    JS 模块化
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            小程序
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/不务正业/小程序/小程序踩坑/">
                                
                                    
                                    小程序踩坑
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            未分类
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/不务正业/未分类/《程序员修炼之道》小抄/">
                                
                                    
                                    《程序员修炼之道》小抄
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/不务正业/未分类/查找日志技巧/">
                                
                                    查找日志技巧
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/不务正业/未分类/知识碎片/">
                                
                                    知识碎片
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/不务正业/未分类/Hexo 特性/">
                                
                                    Hexo 特性
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            设计
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/不务正业/设计/设计零碎/">
                                
                                    
                                    设计零碎
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            算法
                        </a>
                         <ul class="unstyled" id="tree" > 
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            排序
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/算法/排序/基本排序/">
                                
                                    
                                    基本排序
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/算法/排序/快速排序/">
                                
                                    
                                    快速排序
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/算法/排序/堆排序/">
                                
                                    
                                    堆排序
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            搜索
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/算法/搜索/回溯算法/">
                                
                                    
                                    回溯算法
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            数据结构
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/算法/数据结构/链表/">
                                
                                    
                                    链表
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/算法/数据结构/动态规划/">
                                
                                    
                                    动态规划
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/算法/数据结构/树/">
                                
                                    
                                    树
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                     </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            网络
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/网络/HTTPS/">
                                
                                    
                                    HTTPS
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/网络/TCP 与 UDP/">
                                
                                    
                                    TCP 与 UDP
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/网络/TCP 三次握手/">
                                
                                    
                                    TCP 三次握手
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/网络/计算机网络基础/">
                                
                                    
                                    计算机网络基础
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/网络/TCP 四次挥手/">
                                
                                    
                                    TCP 四次挥手
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/网络/重放攻击/">
                                
                                    
                                    重放攻击
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                    
                    <li class="directory">
                        <a href="#" data-role="directory">
                            <i class="fa fa-folder"></i>
                            &nbsp;
                            计算机基础
                        </a>
                         <ul class="unstyled" id="tree" >  
                        <li class="file">
                            <a href="/wiki/计算机基础/Git/">
                                
                                    Git
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/计算机基础/RESTful API/">
                                
                                    
                                    RESTful API
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/计算机基础/原码, 反码, 补码/">
                                
                                    
                                    原码, 反码, 补码
                                
                            </a>
                        </li>  
                        <li class="file">
                            <a href="/wiki/计算机基础/字符编码/">
                                
                                    
                                    字符编码
                                
                            </a>
                        </li>  </ul> 
                    </li> 
                     
                        <li class="file">
                            <a href="/wiki/index/">
                                
                                    工具书签
                                
                            </a>
                        </li>  </ul> 
    </div>
    <script>
        $(document).ready(function() {
            var iconFolderOpenClass  = 'fa-folder-open';
            var iconFolderCloseClass = 'fa-folder';
            var iconAllExpandClass = 'fa-angle-double-down';
            var iconAllPackClass = 'fa-angle-double-up';
            // Handle directory-tree expansion:
            // 左键单独展开目录
            $(document).on('click', '#categories a[data-role="directory"]', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var subtree = $(this).siblings('ul');
                icon.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if (expanded) {
                    if (typeof subtree != 'undefined') {
                        subtree.slideUp({ duration: 100 });
                    }
                    icon.addClass(iconFolderCloseClass);
                } else {
                    if (typeof subtree != 'undefined') {
                        subtree.slideDown({ duration: 100 });
                    }
                    icon.addClass(iconFolderOpenClass);
                }
            });
            // 右键展开下属所有目录
            $('#categories a[data-role="directory"]').bind("contextmenu", function(event){
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var listNode = $(this).siblings('ul');
                var subtrees = $.merge(listNode.find('li ul'), listNode);
                var icons = $.merge(listNode.find('.fa'), icon);
                icons.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);
                if(expanded) {
                    subtrees.slideUp({ duration: 100 });
                    icons.addClass(iconFolderCloseClass);
                } else {
                    subtrees.slideDown({ duration: 100 });
                    icons.addClass(iconFolderOpenClass);
                }
            })
            // 展开关闭所有目录按钮
            $(document).on('click', '#allExpand', function (event) {
                event.preventDefault();
                
                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconAllExpandClass);
                icon.removeClass(iconAllExpandClass).removeClass(iconAllPackClass);
                if(expanded) {
                    $('#sidebar .fa.fa-folder').removeClass('fa-folder').addClass('fa-folder-open')
                    $('#categories li ul').slideDown({ duration: 100 });
                    icon.addClass(iconAllPackClass);
                } else {
                    $('#sidebar .fa.fa-folder-open').removeClass('fa-folder-open').addClass('fa-folder')
                    $('#categories li ul').slideUp({ duration: 100 });
                    icon.addClass(iconAllExpandClass);
                }
            });  
        });
    </script>

    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
            <section id="main"><article id="post-iOS/Runtime/iOS 的 initialize 和 load 区别" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        <header class="article-header">
            
                <div class="article-meta">
                    
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/wiki/categories/iOS/">iOS</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/wiki/categories/iOS/Runtime/">Runtime</a>
    </div>

                    
                    
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/wiki/iOS/Runtime/iOS 的 initialize 和 load 区别/">
            <time datetime="2020-08-15T09:01:57.815Z" itemprop="datePublished">2020-08-15</time>
        </a>
    </div>


                    
                    
                </div>
            
            
    <h1 itemprop="name">
        <a class="article-title" href="/wiki/iOS/Runtime/iOS 的 initialize 和 load 区别/">
            
            iOS 的 initialize 和 load 区别
        </a>
    </h1>

        </header>
        
        <div class="article-entry" itemprop="articleBody">
        
        
        
        
            <p>[TOC]</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">load</th>
<th style="text-align:center">initialize</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">执行次数</td>
<td style="text-align:center">1次</td>
<td style="text-align:center">每个类会被系统只调用一次，但是由于继承的关系，子类未实现的情况下父类的方法会被多次调用</td>
</tr>
<tr>
<td style="text-align:center">执行时机</td>
<td style="text-align:center">所有运行时需要用到的类<br>在main函数开始执行之前，与这个类是否被用到无关</td>
<td style="text-align:center">懒加载，需要使用到具体类的时候才调用 <br>（类或它的子类收到第一条消息之前被调用的，包括实例方法和类方法，如果没收到消息则永远不会调用）</td>
</tr>
<tr>
<td style="text-align:center">作用</td>
<td style="text-align:center">Runtime 交换方法</td>
<td style="text-align:center">初始化全局 oc 对象 <br>（普通对象可以在声明的时候初始化）</td>
</tr>
<tr>
<td style="text-align:center">执行时环境</td>
<td style="text-align:center">系统不稳定，许多东西尚未初始化，调用的时候其它类不一定准备好</td>
<td style="text-align:center">系统处于正常状态，其他类的方法都能正常调用 <br> （特殊情况：如果在 load 方法调用该类的方法会导致 initalize 提前调用，这种情况系统并不稳定）</td>
</tr>
<tr>
<td style="text-align:center">调用顺序</td>
<td style="text-align:center">1. 顺序：父类-&gt;本类-&gt;分类 <br> 2. 分类不会影响本类，分类之间的 load 顺序无法确定 <br> 3. 本类没写，系统在加载本类的时候不会调用其父类 <br> 4. 不同的类或者分类之间的顺序是按 Compile Sources 来确定</td>
<td style="text-align:center">1. 顺序：父类-&gt;本类-&gt;分类 <br> 2. 分类的实现会覆盖本类 <br> 3. 本类没写，会自动调用父类，所以需要先判断类名</td>
</tr>
<tr>
<td style="text-align:center">相同点</td>
<td style="text-align:center">1. 代码要精简，避免处理复杂逻辑 <br> 2 线程安全，不必加锁 <br> 3. 开发者不能显式调用，也不能调用 super <br> 4. 最好不要调用其他类的方法</td>
<td style="text-align:center">同左</td>
</tr>
</tbody>
</table>
<blockquote>
<ul>
<li>load 中最好不要调用其他类的方法，是因为调用的时候其他类不一定加载好</li>
<li>initialize 中最好不要调用其他类的方法，是因为如果这样做，可能产生循环依赖，比如 A 的 initialize 调用了 B 的方法，导致 B 的 initialize 被调用，而 B 的 initialize 也调用了 A 的方法，此时会有问题（而现实情况的互相依赖可能涉及多个类，一旦出现问题就难以定位）</li>
</ul>
</blockquote>
<h1 id="load"><a href="#load" class="headerlink" title="load"></a>load</h1><h2 id="父类的-load-优先于子类"><a href="#父类的-load-优先于子类" class="headerlink" title="父类的 load 优先于子类"></a>父类的 load 优先于子类</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> schedule_class_load(Class cls)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!cls) <span class="keyword">return</span>;</span><br><span class="line">    assert(cls-&gt;isRealized());  <span class="comment">// _read_images should realize</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (cls-&gt;data()-&gt;flags &amp; RW_LOADED) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ensure superclass-first ordering</span></span><br><span class="line">    schedule_class_load(cls-&gt;superclass);</span><br><span class="line"></span><br><span class="line">    add_class_to_loadable_list(cls);</span><br><span class="line">    cls-&gt;setInfo(RW_LOADED);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，对 cls 的处理过程中，优先递归处理了父类，因此父类的 load 一定比子类的优先调用</p>
<h2 id="本类的-load-优先于分类"><a href="#本类的-load-优先于分类" class="headerlink" title="本类的 load 优先于分类"></a>本类的 load 优先于分类</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> call_load_methods(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">BOOL</span> loading = <span class="literal">NO</span>;</span><br><span class="line">    <span class="built_in">BOOL</span> more_categories;</span><br><span class="line"></span><br><span class="line">    recursive_mutex_assert_locked(&amp;loadMethodLock);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Re-entrant calls do nothing; the outermost call will finish the job.</span></span><br><span class="line">    <span class="keyword">if</span> (loading) <span class="keyword">return</span>;</span><br><span class="line">    loading = <span class="literal">YES</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> *pool = objc_autoreleasePoolPush();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">// 1. Repeatedly call class +loads until there aren't any more</span></span><br><span class="line">        <span class="keyword">while</span> (loadable_classes_used &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            call_class_loads();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. Call category +loads ONCE</span></span><br><span class="line">        more_categories = call_category_loads();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. Run more +loads if there are classes OR more untried categories</span></span><br><span class="line">    &#125; <span class="keyword">while</span> (loadable_classes_used &gt; <span class="number">0</span>  ||  more_categories);</span><br><span class="line"></span><br><span class="line">    objc_autoreleasePoolPop(pool);</span><br><span class="line"></span><br><span class="line">    loading = <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中 <code>call_class_loads</code> 是调用本类的 load，而 <code>call_category_loads</code> 是调用分类的 load</p>
<h2 id="系统加载本类的时候为什么不会调用父类"><a href="#系统加载本类的时候为什么不会调用父类" class="headerlink" title="系统加载本类的时候为什么不会调用父类"></a>系统加载本类的时候为什么不会调用父类</h2><p>这里有一点值得探讨：<strong>本类没写，系统在加载本类的时候不会调用其父类</strong></p>
<p>探讨这个问题的前提是，父类的 load 方法是存在的，假如没有实现，讨论调用时机是没有意义的</p>
<p>这里可能会误解为，本类没写，其父类的 load 也不会被调用。加载子类的时候，如果子类没有实现 load 方法，那么系统是不会在此时自动调用父类的 load，因为 load 调用是直接获取函数指针来执行，不会像 <code>objc_msgSend</code> 一样会有方法查找的过程，也就不会沿着继承链往上寻找了。但是这个不意味着父类的 load 方法不会被调用，因为父类也是需要被加载的，所以 load 方法也会被调用，所以这里强调的是时机，本类没有写 load 的情况下，<strong>系统加载本类的时候</strong>不会调用其父类的 load</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> call_class_loads(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Detach current loadable list.</span></span><br><span class="line">    <span class="keyword">struct</span> loadable_class *classes = loadable_classes;</span><br><span class="line">    <span class="keyword">int</span> used = loadable_classes_used;</span><br><span class="line">    loadable_classes = <span class="literal">nil</span>;</span><br><span class="line">    loadable_classes_allocated = <span class="number">0</span>;</span><br><span class="line">    loadable_classes_used = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Call all +loads for the detached list.</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; used; i++) </span><br><span class="line">    &#123;</span><br><span class="line">        Class cls = classes[i].cls;</span><br><span class="line">        <span class="comment">// 这里取到的就是 load 方法</span></span><br><span class="line">        load_method_t load_method = (load_method_t)classes[i].method;</span><br><span class="line">        <span class="keyword">if</span> (!cls) <span class="keyword">continue</span>;</span><br><span class="line">        (*load_method)(cls, SEL_load);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Destroy the detached list.</span></span><br><span class="line">    <span class="keyword">if</span> (classes) _free_internal(classes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>(*load_method)(cls, SEL_load);</code> 说明，load 方法不是通过 <code>objc_msgSend</code> 调用，而是直接通过函数指针调用，因此不会在此次调用中调用父类实现</p>
<h1 id="initialize"><a href="#initialize" class="headerlink" title="initialize"></a>initialize</h1><h2 id="initialize-的正确写法（重要！！！不然有子类的情况下可能会调用多次）"><a href="#initialize-的正确写法（重要！！！不然有子类的情况下可能会调用多次）" class="headerlink" title="initialize 的正确写法（重要！！！不然有子类的情况下可能会调用多次）"></a>initialize 的正确写法（重要！！！不然有子类的情况下可能会调用多次）</h2><p>假设我想要在 A 的 initialize 方法中打印出自己，如果这样写：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">A</span> : <span class="title">NSObject</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">A</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)initialize</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="keyword">self</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">B</span> : <span class="title">A</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">B</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>此时创建一个B对象，输出是</p>
<blockquote>
<p>A<br>B</p>
</blockquote>
<p>初始化 B 的时候，要先初始化 A，所以输出 A，然后初始化 B，由于 B 没有实现 initialize，所以系统调用了 A 的方法，此时 self 是 B</p>
<p>所以 A 的 initialize 方法应该这样写</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)initialize</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> == [A <span class="keyword">class</span>])</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, <span class="keyword">self</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时创建一个B对象，输出是</p>
<blockquote>
<p>B</p>
</blockquote>
<h2 id="initialize-的调用顺序"><a href="#initialize-的调用顺序" class="headerlink" title="initialize 的调用顺序"></a>initialize 的调用顺序</h2><p>以下关键代码来自 objc-runtime-new.mm，当我们给某个类发送消息时，Runtime 会调用该函数。当类没有初始化会调用 <code>void _class_initialize(Class cls)</code> 对该类进行初始化</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">IMP lookUpImpOrForward(Class cls, SEL sel, <span class="keyword">id</span> inst,</span><br><span class="line">    <span class="keyword">bool</span> initialize, <span class="keyword">bool</span> cache, <span class="keyword">bool</span> resolver)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 省略部分代码</span></span><br><span class="line">    <span class="keyword">if</span> (initialize &amp;&amp; !cls-&gt;isInitialized())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 省略部分代码</span></span><br><span class="line">        _class_initialize(_class_getNonMetaClass(cls, inst));</span><br><span class="line">        <span class="comment">// 省略部分代码</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 省略部分代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>_class_initialize</code> 关键代码如下</p>
<ol>
<li>可以看到优先递归处理了父类，因此<strong>父类的 initialize 一定优先于子类</strong></li>
<li>除此之外，从 <code>((void (*)(Class, SEL))objc_msgSend)(cls, SEL_initialize);</code> 看到，本类的 initialize 是通过 <code>objc_msgSend</code> 进行调用，与普通方法的调用是一样的，<strong>如果子类没有实现，那么父类的实现会被调用</strong>；<strong>如果一个类的分类实现了 initialize 方法，那么就会对这个类中的实现造成覆盖</strong></li>
</ol>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _class_initialize(Class cls)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 省略部分代码</span></span><br><span class="line">    Class supercls;</span><br><span class="line">    <span class="built_in">BOOL</span> reallyInitialize = <span class="literal">NO</span>;</span><br><span class="line">    supercls = cls-&gt;superclass;</span><br><span class="line">    <span class="keyword">if</span> (supercls &amp;&amp; !supercls-&gt;isInitialized())</span><br><span class="line">    &#123;</span><br><span class="line">        _class_initialize(supercls);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!cls-&gt;isInitialized() &amp;&amp; !cls-&gt;isInitializing())</span><br><span class="line">    &#123;</span><br><span class="line">        cls-&gt;setInitializing();</span><br><span class="line">        reallyInitialize = <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (reallyInitialize)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 省略部分代码</span></span><br><span class="line">        ((<span class="keyword">void</span> (*)(Class, SEL))objc_msgSend)(cls, SEL_initialize);</span><br><span class="line">        <span class="comment">// 省略部分代码</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 省略部分代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="题目实战"><a href="#题目实战" class="headerlink" title="题目实战"></a>题目实战</h1><p>Compile Sources 中有以下类，顺序如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Daughter.m</span><br><span class="line">Other.m</span><br><span class="line">Father+Category_2.m</span><br><span class="line">Son+Category.m</span><br><span class="line">Son.m</span><br><span class="line">main.m</span><br><span class="line">Other+Category.m</span><br><span class="line">Father+Category_1.m</span><br><span class="line">Father.m</span><br><span class="line">Appdelegate.m</span><br></pre></td></tr></table></figure>
<p>顾名思义，Father 有是 Son 和 Daughter 的父类，Other 与他们没有继承关系</p>
<p>其中除了 Daughter，其他类都写了 load 方法和 initialize 方法，如下</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">void</span>)load</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s %@"</span>, __FUNCTION__, [<span class="keyword">self</span> <span class="keyword">class</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)initialize</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s %@"</span>, __FUNCTION__, [<span class="keyword">self</span> <span class="keyword">class</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.m</span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"Main 函数开始执行"</span>);</span><br><span class="line">        Daughter *daugter = [[Daughter alloc] init];</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, <span class="built_in">NSStringFromClass</span>([AppDelegate <span class="keyword">class</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+[Other(Category) initialize] Other</span><br><span class="line">+[Other load] Other</span><br><span class="line">+[Father(Category_1) initialize] Father</span><br><span class="line">+[Father load] Father</span><br><span class="line">+[Son(Category) initialize] Son</span><br><span class="line">+[Son load] Son</span><br><span class="line">+[Father(Category_2) load] Father</span><br><span class="line">+[Son(Category) load] Son</span><br><span class="line">+[Other(Category) load] Other</span><br><span class="line">+[Father(Category_1) load] Father</span><br><span class="line">Main 函数开始执行</span><br><span class="line">+[Father(Category_1) initialize] Daughter</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>类的加载顺序由 Compile Sources 确定</strong>，即 Daughter &gt; Other &gt; Son &gt; Father，分类的加载是另外一个时机</li>
<li>第一个加载的类是 Daughter，由于没有实现 load，所以没有任何关于 Daughter 的输出，同时也可以看出，<strong>一个类没有实现 load，加载它时不会调用父类的 load</strong></li>
<li>第二个加载的类是 Other，由于在其 load 的中向本类发送了消息，所以导致 initialzie 先于 load 被调用，可以看出，<strong>initialize 调用的时机不是在 main 函数之后，而是在向该类发送第一个消息之前</strong>；第一行输出是 Other 分类的 initialize 方法， Other 自己的 intialize 永远没机会被调用，是因为<strong>分类的 innitialize 会覆盖本类</strong></li>
<li>第三个加载的类是 Son，加载 Son 的时候会优先加载 Father，说明<strong>子类的 load 一定是晚于父类</strong>；同 Other，Father 优先输出了分类的 initialize，再输出 load，那为什么是 <code>Category_1</code> 而不是 <code>Category_2</code> 的 initialze 呢，因为 <code>Category_2</code> 在 Compile Sources 中是晚于 <code>Category_1</code>，因此覆盖了本类和 <code>Category_1</code> 的方法。即<strong>分类的 initialzie 覆盖本类时，以 Compile Sources 中最后一个分类为准</strong></li>
<li>接下来终于轮到 Son 自己加载了，可以看到 Son+Category 的 load 的方法并没有在此时执行，说明<strong>分类的 load 确实晚于主类</strong></li>
<li>最后一个要加载的主类是 Father，而由于 Father 刚刚已经加载过了，因此不会再次调用 load 方法，说明<strong>一个类的 load 方法系统最多只会调用一次</strong></li>
<li>主类加载完之后，终于轮到分类了，<strong>分类的加载顺序取决于其在 Compile Sources 的顺序，而与它们的主类在 Complie Sources 的顺序无关</strong>，本例中 <code>Father(Category_2)</code> &gt; Son(Category) &gt; Other(Category) &gt; <code>Father(Category_1)</code></li>
<li>主类分类加载完毕，开始执行 main 函数。说明<strong>类的 load 都是在 main 函数之前</strong></li>
<li>最后在 main 函数中向 Daughter 发送了一个消息，从而触发了 Daughter 的 initialize，可以看出 <strong>initialize 是懒加载的</strong>；其次，<strong>本类没实现 initialize 的时候，系统会自动调用父类的实现</strong></li>
</ol>
<h1 id="延伸思考"><a href="#延伸思考" class="headerlink" title="延伸思考"></a>延伸思考</h1><h2 id="为什么分类的-load-方法不会被覆盖本类，而-innitialize-会呢"><a href="#为什么分类的-load-方法不会被覆盖本类，而-innitialize-会呢" class="headerlink" title="为什么分类的 load 方法不会被覆盖本类，而 innitialize 会呢"></a>为什么分类的 load 方法不会被覆盖本类，而 innitialize 会呢</h2><p>因为 load 的时候 Runtime 还没有初始化完毕；load 的调用是直接函数调用，而 initialize 是属于消息发送，需要依赖 Runtime</p>
<h2 id="分类实现的普通方法，是如何覆盖本类的"><a href="#分类实现的普通方法，是如何覆盖本类的" class="headerlink" title="分类实现的普通方法，是如何覆盖本类的"></a>分类实现的普通方法，是如何覆盖本类的</h2><h2 id="为什么方法交换要写在-load"><a href="#为什么方法交换要写在-load" class="headerlink" title="为什么方法交换要写在 load"></a>为什么方法交换要写在 load</h2><p>我们可以从 load 的特点得到：</p>
<ul>
<li>方法交换调用一次就够了，而 load 只会被系统调用一次</li>
<li>方法交换越早越好，而 load 方法在 main 函数之前就被调用了</li>
</ul>
<p>但是有这两个原因仍然不足以说明为什么要写在 load，因为 initialize 方法也可以做到一次和越早越好</p>
<p>那么 load 为什么比 initialize 更适合呢，答案是不会有被覆盖的风险，写了就一定会被调用到</p>
<p>写在主类的 initialize 的方法可能被其分类的 initialize 覆盖，而 load 不会</p>
<h2 id="为什么方法交换需要加-dispatch-once，不是说-load-只会执行一次吗"><a href="#为什么方法交换需要加-dispatch-once，不是说-load-只会执行一次吗" class="headerlink" title="为什么方法交换需要加 dispatch_once，不是说 load 只会执行一次吗"></a>为什么方法交换需要加 dispatch_once，不是说 load 只会执行一次吗</h2><p>load 是线程安全的，最多也被系统调用一次，添加 <code>dispatch_once</code> 完全是为了防止不合格的程序员手动调用</p>
<h2 id="多次交换会有什么问题"><a href="#多次交换会有什么问题" class="headerlink" title="多次交换会有什么问题"></a>多次交换会有什么问题</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UIViewController+Category1.m</span></span><br><span class="line">+ (<span class="keyword">void</span>)load</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        swizzleMethod(<span class="keyword">self</span>, <span class="keyword">@selector</span>(viewWillAppear), <span class="keyword">@selector</span>(viewWillAppear_1));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewWillAppear_1:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __FUNCTION__);</span><br><span class="line">    [<span class="keyword">self</span> viewWillAppear_1:animated];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UIViewController+Category2.m</span></span><br><span class="line">+ (<span class="keyword">void</span>)load</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        swizzleMethod(<span class="keyword">self</span>, <span class="keyword">@selector</span>(viewWillAppear), <span class="keyword">@selector</span>(viewWillAppear_2));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewWillAppear_2:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%s"</span>, __FUNCTION__);</span><br><span class="line">    [<span class="keyword">self</span> viewWillAppear_2:animated];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>假如 UIViewController+Category1 的 load 比 UIViewController+Category2 先执行，那么执行此时所有的 UIViewController 即将出现的时候将会调用哪些方法</p>
<p>答案：调用顺序如下</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">viewWillAppear_2</span><br><span class="line">viewWillAppear_1</span><br><span class="line">viewWillAppear</span><br></pre></td></tr></table></figure>
<p>交换之前</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@selector</span>(viewWillAppear) -&gt; viewWillAppear<span class="string">'s IMP</span></span><br><span class="line"><span class="string">@selector(viewWillAppear_1) -&gt; viewWillAppear_1'</span>s IMP</span><br><span class="line"><span class="keyword">@selector</span>(viewWillAppear_2) -&gt; viewWillAppear_2<span class="string">'s IMP</span></span><br></pre></td></tr></table></figure>
<p>第一次交换：UIViewController+Category1 的 load</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@selector</span>(viewWillAppear) -&gt; viewWillAppear_1<span class="string">'s IMP</span></span><br><span class="line"><span class="string">@selector(viewWillAppear_1) -&gt; viewWillAppear'</span>s IMP</span><br><span class="line"><span class="keyword">@selector</span>(viewWillAppear_2) -&gt; viewWillAppear_2<span class="string">'s IMP</span></span><br></pre></td></tr></table></figure>
<p>第二次交换：UIViewController+Category2 的 load</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@selector</span>(viewWillAppear) -&gt; viewWillAppear_2<span class="string">'s IMP</span></span><br><span class="line"><span class="string">@selector(viewWillAppear_1) -&gt; viewWillAppear'</span>s IMP</span><br><span class="line"><span class="keyword">@selector</span>(viewWillAppear_2) -&gt; viewWillAppear_1<span class="string">'s IMP</span></span><br></pre></td></tr></table></figure>
<ol>
<li>调用 viewWillAppear，执行的是其对应的 IMP， 即 <code>viewWillAppear_2</code></li>
<li>然后 <code>viewWillAppear_2</code> 的 IMP 里又调用了 @selector(viewWillAppear_2) ，执行的是 <code>viewWillAppear_1</code> 的 IMP</li>
<li>最后 <code>viewWillAppear_1</code> 的 IMP 里又调用了 @selector(viewWillAppear_1) ，执行的是 <code>viewWillAppear</code> 的 IMP</li>
</ol>
<h2 id="load-方法中实现方法交换的时候采用-c-函数"><a href="#load-方法中实现方法交换的时候采用-c-函数" class="headerlink" title="load 方法中实现方法交换的时候采用 c 函数"></a>load 方法中实现方法交换的时候采用 c 函数</h2><p>swizzleMethod 采用 C 函数，而不是 NSObject 的方法，是为了防止子类在 load 方法中向其自己发送消息，那样会导致其 +initialize 方法在 load 的时候被提前调用，而此时系统环境是不稳定的</p>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><ul>
<li><a href="http://blog.leichunfeng.com/blog/2015/05/02/objective-c-plus-load-vs-plus-initialize/" target="_blank" rel="noopener">《Objective-C +load vs +initialize》</a></li>
<li><a href="https://www.jianshu.com/p/ffdefa76e4a2" target="_blank" rel="noopener">《一道题搞清楚Objective-C中load和initialize》</a></li>
<li>《Effective Objective-C 2.0 编写高质量 iOS 与 OS X 代码的52个有效方法》第 51 条</li>
</ul>

            </div>
        
        <footer class="article-footer">
        </footer>
    </div>
</article>
<div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#load"><span class="toc-number">1.</span> <span class="toc-text">load</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#父类的-load-优先于子类"><span class="toc-number">1.1.</span> <span class="toc-text">父类的 load 优先于子类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#本类的-load-优先于分类"><span class="toc-number">1.2.</span> <span class="toc-text">本类的 load 优先于分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#系统加载本类的时候为什么不会调用父类"><span class="toc-number">1.3.</span> <span class="toc-text">系统加载本类的时候为什么不会调用父类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#initialize"><span class="toc-number">2.</span> <span class="toc-text">initialize</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#initialize-的正确写法（重要！！！不然有子类的情况下可能会调用多次）"><span class="toc-number">2.1.</span> <span class="toc-text">initialize 的正确写法（重要！！！不然有子类的情况下可能会调用多次）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#initialize-的调用顺序"><span class="toc-number">2.2.</span> <span class="toc-text">initialize 的调用顺序</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#题目实战"><span class="toc-number">3.</span> <span class="toc-text">题目实战</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#延伸思考"><span class="toc-number">4.</span> <span class="toc-text">延伸思考</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么分类的-load-方法不会被覆盖本类，而-innitialize-会呢"><span class="toc-number">4.1.</span> <span class="toc-text">为什么分类的 load 方法不会被覆盖本类，而 innitialize 会呢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分类实现的普通方法，是如何覆盖本类的"><span class="toc-number">4.2.</span> <span class="toc-text">分类实现的普通方法，是如何覆盖本类的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么方法交换要写在-load"><span class="toc-number">4.3.</span> <span class="toc-text">为什么方法交换要写在 load</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么方法交换需要加-dispatch-once，不是说-load-只会执行一次吗"><span class="toc-number">4.4.</span> <span class="toc-text">为什么方法交换需要加 dispatch_once，不是说 load 只会执行一次吗</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多次交换会有什么问题"><span class="toc-number">4.5.</span> <span class="toc-text">多次交换会有什么问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#load-方法中实现方法交换的时候采用-c-函数"><span class="toc-number">4.6.</span> <span class="toc-text">load 方法中实现方法交换的时候采用 c 函数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#参考文章"><span class="toc-number">5.</span> <span class="toc-text">参考文章</span></a></li></ol>
</div></section>
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            TK &copy; 2020 
            <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a>
            <br> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme - <a href="https://github.com/zthxxx/hexo-theme-Wikitten">wikitten</a>
            
        </div>
    </div>
</footer>

        

    
        <script src="/wiki/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/wiki/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/wiki/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/wiki/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/wiki/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/wiki/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/wiki/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/wiki/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/wiki/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/wiki/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    
        <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true,
            TeX: {
                equationNumbers: {
                  autoNumber: 'AMS'
                }
            }
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    



<!-- Custom Scripts -->
<script src="/wiki/js/main.js"></script>

    </div>
</body>
</html>